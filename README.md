# 分布式高性能五子棋对战引擎（服务端）

一个面向 **高并发、实时对战** 场景的五子棋服务端通信引擎。

项目以 **Netty** 为核心通信框架，基于 **WebSocket 长连接** 构建实时对战模型，结合 **Redis** 实现分布式状态管理与高可用机制，并通过系统化的并发测试与性能分析，验证整体架构在真实压力场景下的稳定性与工程可行性。

在业务层面，本项目并非传统五子棋实现，而是在经典规则基础上引入了**多类型棋子、技能机制、冷却时间与局部博弈判定**，使对战过程具备更复杂的状态演化与策略深度，从而为实时通信、状态同步与回合一致性提供更具挑战性的验证场景。

> 本项目关注的核心问题不仅是“五子棋规则本身”，更是：**如何在复杂、可变的对局规则下，设计并验证一个可长期稳定运行、可预测、可扩展的实时通信后端系统。**

------

## 技术栈

- **语言 / 平台**：Java 21
- **网络通信**：Netty（NIO / Reactor）、WebSocket
- **通信协议**：Google Protobuf（自定义二进制协议）
- **分布式组件**：Redis、Redisson
- **并发与稳定性测试**：Apache JMeter（CLI Mode）

------

## 核心设计与能力

- **高并发通信架构**
  基于 Netty 构建主从 Reactor 线程模型，明确区分 IO 线程与业务线程职责，避免 EventLoop 阻塞，支持高并发 WebSocket 握手与长连接通信场景。
- **实时对战与弱网适配**
  采用 WebSocket 长连接通信模型，配合应用层心跳与状态同步机制，实现断线重连与对局状态恢复，确保弱网环境下对战流程的连续性与一致性。
- **高效通信协议设计**
  使用 Google Protobuf 替代 JSON 作为通信协议，解决 TCP 粘包 / 拆包问题，显著降低网络载荷体积与序列化开销，提升弱网环境下的传输效率。
- **分布式状态管理**
  通过 Redis + Redisson 构建无状态网关架构，集中管理用户会话、房间状态与对局生命周期，支持多实例部署与横向扩展。
- **高可用与一致性保障**
  设计基于有限状态机（FSM）的对局状态流转机制，结合 Redisson Delayed Queue 实现回合超时与断线判负，确保对战逻辑在异常场景下仍具备最终一致性。

------

## 并发与稳定性验证

项目围绕实时对战系统的关键路径，进行了系统化的并发与稳定性测试，包括但不限于：

- HTTP 登录接口并发验证
- WebSocket 握手（HTTP Upgrade）性能分析
- 高并发瞬时建连场景
- WebSocket 长连接保持与异常断连处理（零异常）
- 弱网环境下的对战稳定性验证

在 **单机与云服务器环境** 下，通过 JMeter CLI 模式完成多组并发测试，验证系统在连接风暴与弱网条件下的稳定性（**0 报错、无连接泄漏**），并对性能瓶颈进行了逐步定位与工程级分析。

**详细的测试模型、数据结果与分析过程请参见：**
**[benchmark/README.md](./benchmark/README.md)**

------

## 文档索引

- **并发与性能测试说明**：`benchmark/README.md`
- **性能瓶颈分析与优化过程**：`benchmark/analysis.md`
- **系统整体架构设计**：`docs/architecture.md`
- **Netty 线程模型与 Handler 设计说明**：`docs/netty-thread-model.md`

------

## 项目定位说明

本项目主要用于：

- 在校招 / 技术面试中展示 **后端系统设计、并发处理与工程验证能力**
- 验证 Netty 在高并发实时通信场景下的工程实践方式
- 总结 WebSocket 系统在连接生命周期、线程模型与异常处理方面的常见问题及解决思路

**该仓库侧重于“工程验证与设计实践”，而非完整商业产品实现。**

-------------------------

## 在线体验 / Demo

> 本项目已部署于云服务器（Docker 化前后端分离部署），用于验证真实网络环境下的并发与稳定性表现。

- **前端入口**： 
   http://47.106.72.70

- **WebSocket 服务地址**： 
  `ws://47.106.72.70/ws`

- **说明**：
  - 前端页面仅用于演示对战流程与实时通信能力
  - 服务端重点在于并发模型、连接生命周期与系统稳定性验证
  - 不保证长期在线（非商业化服务）

------

## 作者

- 核心开发者：周晖
- 项目周期：2025.10 – 2026.1
