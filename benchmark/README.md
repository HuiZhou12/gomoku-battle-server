# Benchmark 总览（并发与性能验证）

本 Benchmark 用于验证 **分布式高性能五子棋对战引擎**
在高并发实时通信场景下的稳定性、性能边界与工程可预测性。

测试重点不在于追求极限 TPS，而是通过 **可复现的并发与网络模型**，
验证系统在 WebSocket 场景下是否具备：

- 稳定性
- 可预测性
- 可分析性

---

## 1. 测试环境概览

| 项目       | 说明                                          |
| ---------- | --------------------------------------------- |
| 操作系统   | Windows 11                                    |
| CPU        | Intel Core i5-10210U（4C / 8T，移动端低功耗） |
| 内存       | 16 GB                                         |
| JDK        | OpenJDK 21                                    |
| 网络环境   | 本机回环（localhost）                         |
| 服务端框架 | Netty (NIO)                                   |
| 状态管理   | Redis / Redisson                              |
| 压测工具   | Apache JMeter（CLI 模式）                     |

> 说明：  
> 所有测试均在 **单机环境** 下完成，结果主要反映系统在**极端并发与不理想网络条件** 下的工程行为，不直接等同于生产环境的最终容量指标。

---

## 2. 测试方法论概述

### 2.1 并发模型

- 并发模式：**瞬时并发**
- 并发规模：`500`
- 总请求数：`1000`
- 客户端行为：并发启动 → 完成请求 → 断开连接

该模型用于模拟以下典型场景：

- 高峰期大量玩家同时登录进入游戏大厅
- WebSocket 握手请求在短时间内集中到达
- 服务端需快速完成连接建立与上下文初始化

---

### 2.2 单线程执行路径

每个压测线程覆盖以下完整接入路径：

1. HTTP 登录获取 JWT
2. WebSocket 建连并完成握手
3. 初始化连接上下文
4. 连接关闭（短连接测试）

该路径覆盖 **登录、鉴权、WebSocket 握手** 的完整关键链路。

---

### 2.3 关注的核心指标

- 响应时间：Avg / Max
- 吞吐量：req/s
- 错误率：连接失败、异常断连、服务端异常
- 系统行为：是否出现阻塞、异常风暴或不可预测抖动

---

## 3. 已完成测试项一览

| 测试项                     | 说明                                     | 文档位置                    |
| -------------------------- | ---------------------------------------- | --------------------------- |
| WebSocket 握手并发测试     | 验证登录 + WS 握手在瞬时高并发下的稳定性 | `tests/ws-handshake/`       |
| WebSocket 长连接稳定性测试 | 验证心跳机制与长期连接资源稳定性         | `tests/ws-long-connection/` |
| 弱网对战稳定性测试         | 验证弱网条件下重连、心跳与状态一致性     | `tests/ws-weak-network/`    |

> 每个测试项均包含：
> - 独立 README（测试模型与结果）
> - 可复现脚本
> - 数据或截图说明

---

## 4. 关键结论速览

- 系统在 **500 并发 WebSocket 握手** 场景下保持 **0 错误率**
- 已消除异常路径放大（NPE / ClosedChannel）与 EventLoop 阻塞问题
- 高并发与弱网场景下系统行为稳定、可预测
- 未出现线程耗尽、连接泄漏或状态错乱现象

当前性能瓶颈主要来源于：

- 单机环境下的 TCP 建连能力限制
- WebSocket 握手阶段的协议开销
- 客户端与服务端共机部署导致的资源竞争

---

## 5. 工程结论

综合多轮并发测试与稳定性验证，可以确认：

- 当前系统架构与线程模型在实时通信场景下是 **工程上成立的**
- 系统具备在更高负载与分布式环境下进一步扩展的基础
- Benchmark 结果可作为后续业务消息压测与容量评估的基线

更详细的测试模型、数据与分析过程，
请参见各测试目录下的 README 与 analysis 文档。